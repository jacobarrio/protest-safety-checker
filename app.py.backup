#!/usr/bin/env python3
from flask import Flask, render_template, request, jsonify
from calculator import load_data, calculate_city_risk

app = Flask(__name__)

# Load data once at startup
df = load_data()

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/api/check', methods=['POST'])
def check_city():
    """API endpoint to check city risk"""
    data = request.get_json()
    city = data.get('city', '')
    
    if not city:
        return jsonify({'error': 'City name required'}), 400
    
    result = calculate_city_risk(city, df)
    return jsonify(result)

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=5000)
