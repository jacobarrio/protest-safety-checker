<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protest Safety Checker - ICE Activity Risk Assessment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">
    <div class="max-w-4xl mx-auto px-4 py-12">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold text-slate-900 mb-4">üõ°Ô∏è Protest Safety Checker</h1>
            <p class="text-xl text-slate-600 font-medium">ICE Activity Risk Assessment</p>
            <p class="text-sm text-slate-500 mt-3">Data from <a href="https://oversightdemocrats.house.gov/immigration-enforcement-dashboard" target="_blank" class="text-blue-600 hover:underline">House Oversight Democrats Immigration Dashboard</a></p>
            <p class="text-xs text-slate-400 mt-1">462+ verified incidents | Nov 2025 - Jan 2026 | 186 cities tracked</p>
        </div>

        <!-- Disclaimer -->
        <div class="bg-amber-50 border-l-4 border-amber-500 rounded-lg p-4 mb-8">
            <p class="text-sm text-amber-900">
                <strong>‚ö†Ô∏è Disclaimer:</strong> This tool provides historical data analysis, not predictions. 
                Use for awareness and education. Not legal advice. Always know your rights and consult with legal experts.
            </p>
        </div>

        <!-- Search Box -->
        <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <label class="block text-lg font-semibold text-gray-700 mb-4">Enter Your City:</label>
            <div class="flex gap-4">
                <input 
                    type="text" 
                    id="cityInput"
                    placeholder="e.g., Portland, Chicago, Minneapolis"
                    class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
                />
                <button 
                    onclick="checkCity()"
                    class="px-8 py-3 bg-slate-800 text-white font-semibold rounded-lg hover:bg-slate-700 transition-colors"
                >
                    Check Risk
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="hidden text-center py-8">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
            <p class="text-gray-600 mt-4">Analyzing data...</p>
        </div>

        <!-- Results -->
        <div id="results" class="hidden">
            <!-- Risk Level Card -->
            <div id="riskCard" class="rounded-lg shadow-lg p-8 mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold mb-2" id="riskTitle"></h2>
                        <p class="text-lg" id="riskScore"></p>
                    </div>
                    <div class="text-6xl" id="riskEmoji"></div>
                </div>
            </div>

            <!-- Statistics Grid -->
            <div class="grid md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow p-6">
                    <p class="text-sm text-gray-600 mb-1">Total Incidents</p>
                    <p class="text-3xl font-bold text-gray-900" id="statTotal">0</p>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <p class="text-sm text-gray-600 mb-1">Use of Force</p>
                    <p class="text-3xl font-bold text-red-600" id="statForce">0</p>
                    <p class="text-xs text-gray-500" id="statForcePct"></p>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <p class="text-sm text-gray-600 mb-1">U.S. Citizens</p>
                    <p class="text-3xl font-bold text-orange-600" id="statCitizen">0</p>
                    <p class="text-xs text-gray-500" id="statCitizenPct"></p>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <p class="text-sm text-gray-600 mb-1">Sensitive Locations</p>
                    <p class="text-3xl font-bold text-purple-600" id="statSensitive">0</p>
                    <p class="text-xs text-gray-500" id="statSensitivePct"></p>
                </div>
            </div>

            <!-- Recent Incidents -->
            <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
                <h3 class="text-xl font-bold text-gray-900 mb-4">üì∞ Recent Incidents</h3>
                <div id="incidentsList" class="space-y-4"></div>
            </div>

            <!-- Safety Recommendations -->
            <div id="recommendations" class="rounded-lg shadow-lg p-8">
                <h3 class="text-xl font-bold text-gray-900 mb-4">üí° Safety Recommendations</h3>
                <div id="recommendationsList"></div>
            </div>
        </div>

        <!-- Error Message -->
        <div id="error" class="hidden bg-red-50 border border-red-200 rounded-lg p-6 text-center">
            <p class="text-red-800 font-semibold mb-2" id="errorMessage"></p>
            <p class="text-red-600 text-sm">Try: Chicago, Minneapolis, Portland, Los Angeles, Phoenix, New York, Washington DC</p>
        </div>

        <!-- How It Works -->
        <div class="bg-white rounded-lg shadow-lg p-8 mt-8 mb-8">
            <h3 class="text-xl font-bold text-slate-900 mb-4">üìä How It Works</h3>
            <div class="text-sm text-slate-600 space-y-2">
                <p>‚Ä¢ <strong>Data Source:</strong> Congressional oversight data from verified news reports (House Oversight Democrats)</p>
                <p>‚Ä¢ <strong>Risk Calculation:</strong> Weighted scoring based on use of force, U.S. citizen targeting, and sensitive location incidents</p>
                <p>‚Ä¢ <strong>Coverage:</strong> 186 cities across the U.S. with documented ICE enforcement activity</p>
            </div>
        </div>

        <!-- Footer -->
        <div class="mt-12 pt-8 border-t border-slate-200 text-center text-sm text-slate-600">
            <p class="font-semibold mb-2">Built to protect organizers and communities</p>
            <p class="mb-3">by <strong>Jacob Lee</strong>, ML Engineer | Vancouver, WA</p>
            <div class="flex justify-center gap-4 mb-4">
                <a href="https://github.com/jacobarrio/protest-safety-checker" target="_blank" class="inline-flex items-center gap-2 px-4 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 transition-colors">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
                    View Source Code
                </a>
            </div>
            <p class="text-xs text-slate-400">Open source ‚Ä¢ Public domain ‚Ä¢ Use to protect people</p>
        </div>
    </div>

    <script>
        function checkCity() {
            const city = document.getElementById('cityInput').value.trim();
            if (!city) {
                alert('Please enter a city name');
                return;
            }

            // Show loading, hide others
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');

            // Call API
            fetch('/api/check', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({city: city})
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById('loading').classList.add('hidden');

                if (data.error || !data.total_incidents || data.total_incidents === 0) {
                    // No data found
                    document.getElementById('errorMessage').textContent = data.error || 'No data found for this city';
                    document.getElementById('error').classList.remove('hidden');
                    return;
                }

                // Show results
                displayResults(data);
            })
            .catch(err => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('errorMessage').textContent = 'Error loading data. Please try again.';
                document.getElementById('error').classList.remove('hidden');
            });
        }

        function displayResults(data) {
            // Risk card styling
            const riskCard = document.getElementById('riskCard');
            const colors = {
                'High': 'bg-red-100 border-2 border-red-500',
                'Medium': 'bg-yellow-100 border-2 border-yellow-500',
                'Low': 'bg-green-100 border-2 border-green-500'
            };
            riskCard.className = `rounded-lg shadow-lg p-8 mb-6 ${colors[data.risk_level]}`;

            // Risk level
            document.getElementById('riskEmoji').textContent = {
                'High': 'üî¥', 'Medium': 'üü°', 'Low': 'üü¢'
            }[data.risk_level];
            document.getElementById('riskTitle').textContent = `Risk Level: ${data.risk_level}`;
            document.getElementById('riskScore').textContent = `Risk Score: ${data.risk_score}/100`;

            // Statistics
            document.getElementById('statTotal').textContent = data.total_incidents;
            document.getElementById('statForce').textContent = data.use_of_force;
            document.getElementById('statForcePct').textContent = `${data.use_of_force_pct}%`;
            document.getElementById('statCitizen').textContent = data.us_citizens;
            document.getElementById('statCitizenPct').textContent = `${data.us_citizens_pct}%`;
            document.getElementById('statSensitive').textContent = data.sensitive_locations;
            document.getElementById('statSensitivePct').textContent = `${data.sensitive_locations_pct}%`;

            // Recent incidents
            const incidentsList = document.getElementById('incidentsList');
            incidentsList.innerHTML = data.recent_incidents.slice(0, 5).map(inc => {
                const category = inc.category ? inc.category : 'Category unknown';
                return `
                    <div class="border-l-4 border-blue-500 pl-4 py-2">
                        <p class="text-sm text-gray-600">${inc.date || 'Unknown date'}</p>
                        <p class="text-gray-900">${inc.title || 'No title available'}</p>
                        <p class="text-xs text-gray-500 mt-1">${category}</p>
                    </div>
                `;
            }).join('');

            // Recommendations
            const recDiv = document.getElementById('recommendations');
            const recList = document.getElementById('recommendationsList');
            
            if (data.risk_level === 'High') {
                recDiv.className = 'bg-red-50 border-2 border-red-500 rounded-lg shadow-lg p-8';
                recList.innerHTML = `
                    <ul class="space-y-2 text-gray-800">
                        <li>‚ö†Ô∏è <strong>High risk of ICE encounters</strong></li>
                        <li>‚Ä¢ Know your rights - you can remain silent</li>
                        <li>‚Ä¢ Don't open doors without warrant</li>
                        <li>‚Ä¢ Document any encounters (video/photos)</li>
                        <li>‚Ä¢ Have emergency contacts ready</li>
                    </ul>
                `;
            } else if (data.risk_level === 'Medium') {
                recDiv.className = 'bg-yellow-50 border-2 border-yellow-500 rounded-lg shadow-lg p-8';
                recList.innerHTML = `
                    <ul class="space-y-2 text-gray-800">
                        <li>‚ö†Ô∏è <strong>Moderate risk - stay alert</strong></li>
                        <li>‚Ä¢ Be aware of your surroundings</li>
                        <li>‚Ä¢ Know your rights</li>
                        <li>‚Ä¢ Have emergency plan in place</li>
                    </ul>
                `;
            } else {
                recDiv.className = 'bg-green-50 border-2 border-green-500 rounded-lg shadow-lg p-8';
                recList.innerHTML = `
                    <ul class="space-y-2 text-gray-800">
                        <li>‚úì <strong>Lower risk, but stay informed</strong></li>
                        <li>‚Ä¢ Keep monitoring local reports</li>
                        <li>‚Ä¢ Know your rights just in case</li>
                    </ul>
                `;
            }

            document.getElementById('results').classList.remove('hidden');
        }

        // Allow Enter key to submit
        document.getElementById('cityInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkCity();
        });
    </script>
</body>
</html>
